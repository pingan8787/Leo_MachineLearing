## Python学习（三）函数方法等
### 一、学习网站
>廖雪峰 Python进阶 慕课网：[点击打开](http://www.imooc.com/learn/317)


### 二、函数式编程

#### 1、函数式编程特点：
>把计算视为函数而非指令；  
>纯函数式编程：不需要变量，没有副作用，测试简单；  
>支持高阶函数，代码简洁；  

#### 2、python函数式编程特点：
>不是纯函数式编程：允许有变量；  
>支持高阶函数：函数也可以作为变量传入；  
>支持闭包：有了闭包就能返回函数；   
>有限度的支持匿名函数；  

#### 3、高阶函数 案例：
变量可以指向函数，比如：  
```
abs(-10)     # 10
abs          # 返回一个函数变量
f = abs      # 使用变量f指向abs
f(-10)       # 10
```
函数名其实就是指向函数的变量  
```
abs(-10)       # 10
abs = len      # 将len赋值给abs
abs(-10)       # 报错
abs([1,2,3])   # 3
```
#### 4、高阶函数 概念：
>能接收函数作为参数的函数;  
>变量可以指向函数;  
>函数的参数可以接收变量;  
>一个函数可以接收另一个函数作为参数;  
>能接收函数作参数的函数就是高阶函数;  
```
def add(x,y,fun):
    return fun(x)+fun(y)
add(-4,9,abs)              # 14
```
#### 5、python内置高阶函数 -- map()函数
它接收一个函数 `f` 和一个 `list`，并通过把函数 `f` 依次作用在 `list` 的每个元素上，得到一个新的 `list` 并返回。  
```
def f(x):
    return x*x
print map(f, [1, 2, 3, 4, 5, 6, 7, 8, 9])
```
>注意：map()函数不改变原有的 list，而是返回一个新的 list。  
由于list包含的元素可以是任何类型，因此，`map()` 不仅仅可以处理只包含数值的 `list`，事实上它可以处理包含任意类型的 `list`，只要传入的`函数f`可以处理这种数据类型。  
案例：  
将所有姓名转换成 `'Adam'` 格式：   
```
def format_name(s):
    return s[:1].upper()+s[1:].lower()
print map(format_name, ['adam', 'LISA', 'barT'])
```
#### 6、python内置高阶函数 -- reduce()函数
它接收一个函数 `f` 和一个 `list`，函数f必须传入`2个参数`，`reduce()`对`list`的每个元素反复调用`函数f`，并返回最终结果值。  
函数f接收的两个参数，即为`list`里相邻的两个参数。  
```
def f(x, y):
    return x + y
reduce(f,[1,3,5,7,9])   # 先计算f(1,3)得4，再将结果带入f(4,5)得9，然后f(9,7)得16  f(16,9)得25
```
reduce()还可以接收第三个参数，作为计算初始值。   
```
def f(x,y):
    return x+y
reduce(f, [1, 3, 5, 7, 9], 100)    # 125
```
案例：   
利用`reduce()`实现求积函数。   
```
def prod(x, y):
    return x*y
print reduce(prod, [2, 4, 5, 7, 12])
```
#### 7、python内置高阶函数 -- filter()函数
它接收一个函数 `f` 和一个 `list`,这个函数作用是对每个元素进行判断，返回`True` 和 `False` 。   
`filter()`根据判断结果自动过滤掉不符合条件的元素，返回由符合条件元素组成的`新list`。   
例如：要从一个list [1, 4, 6, 7, 9, 12, 17]中删除偶数，保留奇数，  
```
def is_odd(x):                              # 定义判断函数
    return x % 2 == 1
filter(is_odd, [1, 4, 6, 7, 9, 12, 17])     # 过滤偶数   返回 [1, 7, 9, 17]
```
例如：删除None或者空字符串，   
```
def is_not_empty(s):
    return s and len(s.strip()) > 0
filter(is_not_empty, ['test', None, '', 'str', ' ', 'END'])     # ['test', 'str', 'END']
```
>注意: s.strip(rm) 删除 s 字符串中开头、结尾处的 rm 序列的字符。  

当`rm`为空时，默认删除空白符（包括'\n', '\r', '\t', ' ')，如下：  
```
a = '   123'
a.strip()        # '123'
a='\t\t123\r\n'
a.strip()        # '123'
```
案例：  
利用`filter()`过滤出1~100中平方根是整数的数：  
```
import math
def is_sqr(x):
    r = int(math.sqrt(x))             # math.sqrt()返回结果是浮点数 用来计算平方根
    return r*r==x
print filter(is_sqr, range(1, 101))   # [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]
```
#### 8、python内置高阶函数 -- sorted()函数 自定义排序
```
sorted([36, 5, 12, 9, 21])     #  [5, 9, 12, 21, 36]
```
它可以接收一个`比较函数`来实现`自定义排序`，比较函数的定义是，传入两个待比较的元素 `x, y`，如果 `x` 应该排在 `y` 的前面，返回 `-1`，如果 `x` 应该排在 `y` 的后面，返回 `1`。如果 `x` 和 `y` 相等，返回 `0`。
```
def reversed_cmp(x, y):      # 实现倒序排序
    if x > y:
        return -1
    if x < y:
        return 1
    return 0
sorted([36,5,12,9,21],reversed_cmp)
```
`sorted()`也可以对字符串进行排序，字符串默认按照`ASCII大小`来比较：   
```
sorted(['bob', 'about', 'Zoo', 'Credit'])      # ['Credit', 'Zoo', 'about', 'bob']
```
`'Zoo'`排在`'about'`之前是因为`'Z'`的ASCII码比`'a'`小。   
案例：  
利用`sorted()`高阶函数，实现忽略大小写排序的算法。  
```
def cmp_ignore_case(s1, s2):
    u1 = s1.upper()
    u2 = s2.upper()
    if u1<u2:
        return -1
    if u1>u2:
        return 1
    return 0

print sorted(['bob', 'about', 'Zoo', 'Credit'], cmp_ignore_case)  # ['about', 'bob', 'Credit', 'Zoo']
```

#### 9、python中返回函数
Python的函数不但可以返回`int`、`str`、`list`、`dict`等数据类型，还可以`返回函数`！  
```
def f():
    print 'call f()...'
    def g():
        print 'call g()'
    return g
x = f()      # 'call f()...'   x是f()返回的函数
x()          # 'call g()...'   x指向函数，因此可以调用，x()执行的就是g()函数
```
注意区分返回函数和返回值：  
```
def myabs():
    return abs           # 返回函数
def myabs2():
    return abs(x)        # 返回函数调用的结果，返回值是个数值
使用返回函数，来实现“延迟计算”：
def calc_sum(lst):
    def lazy_sum():
        return sum(lst)
    return lazy_sum      # 调用calc_sum()返回的是函数
f = calc_sum([1,3,5,6])  # 此时f是一个函数，由calc_sum()返回的函数
f()                      # 15
```
案例：  
请编写一个函数`calc_prod(lst)`，它接收一个`list`，返回一个函数，返回函数可以计算参数的乘积。 
``` 
def calc_prod(lst):
    def lazy_prod():
        def f(x,y):          # 由于要使用reduce()
            return x*y
        return reduce(f,lst,1)
    return lazy_prod
f = calc_prod([1, 2, 3, 4])
print f()
```
